apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
type: Opaque
stringData:
  POSTGRES_USER: snuser
  POSTGRES_PASSWORD: tesT123s4n
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
data:
  POSTGRES_DB: sndb
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
spec:
  accessModes:
    - ReadWriteOnce # –û–∑–Ω–∞—á–∞—î: "–ú–æ–∂–µ –±—É—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å—É –ª–∏—à–µ –æ–¥–Ω–∏–º –≤—É–∑–ª–æ–º (node)"
  resources:
    requests:
      storage: 1Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
        - name: postgres
          image: postgres:16
          ports:
            - containerPort: 5432
          envFrom:
            - configMapRef:
                name: postgres-config
            - secretRef:
                name: postgres-secret
          volumeMounts: # üëà –ö–†–û–ö 2: –ú–æ–Ω—Ç—É—î–º–æ –π–æ–≥–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            - name: postgres-storage # –Ü–º'—è –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ —Ç–∏–º, —â–æ –≤ 'volumes'
              mountPath: /var/lib/postgresql/data # –®–ª—è—Ö –∑ docker-compose.yml
      volumes: # üëà –ö–†–û–ö 1: –û–≥–æ–ª–æ—à—É—î–º–æ —Ç–æ–º –¥–ª—è Pod'–∞
        - name: postgres-storage # –ú–∏ –≤–∏–≥–∞–¥—É—î–º–æ —Ü–µ —ñ–º'—è
          persistentVolumeClaim:
            claimName: postgres-pvc # –ü–æ—Å–∏–ª–∞—î–º–æ—Å—å –Ω–∞ –Ω–∞—à PVC
---
apiVersion: v1
kind: Service
metadata:
  name: postgres
spec:
  selector:
    app: postgres
  ports:
    - protocol: TCP
      port: 5432
      targetPort: 5432